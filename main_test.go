package main

import (
	"testing"
)

func TestParseFile(t *testing.T) {
	test_input := `[{"architecture":"x86_64","config":{"volatile.base_image":"f2228450779fee27020d6024af587379b8f51062c32a335327f2b028c924bfa1","volatile.eth0.hwaddr":"00:16:3e:d7:d0:78","volatile.idmap.base":"0","volatile.idmap.next":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.idmap":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.power":"RUNNING"},"devices":{"root":{"path":"/","type":"disk"}},"ephemeral":false,"profiles":["default"],"stateful":false,"description":"","created_at":"2018-07-04T06:36:28Z","expanded_config":{"environment.http_proxy":"","user.network_mode":"link-local","volatile.base_image":"f2228450779fee27020d6024af587379b8f51062c32a335327f2b028c924bfa1","volatile.eth0.hwaddr":"00:16:3e:d7:d0:78","volatile.idmap.base":"0","volatile.idmap.next":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.idmap":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.power":"RUNNING"},"expanded_devices":{"eth0":{"name":"eth0","nictype":"bridged","parent":"lxdbr0","type":"nic"},"root":{"path":"/","type":"disk"}},"name":"something-ubuntu","status":"Running","status_code":103,"last_used_at":"0001-01-01T00:00:00Z","state":{"status":"Running","status_code":103,"disk":{"root":{"usage":6401536}},"memory":{"usage":88571904,"usage_peak":215478272,"swap_usage":0,"swap_usage_peak":0},"network":{"eth0":{"addresses":[{"family":"inet6","address":"fe80::216:3eff:fed7:d078","netmask":"64","scope":"link"}],"counters":{"bytes_received":648,"bytes_sent":648,"packets_received":8,"packets_sent":8},"hwaddr":"00:16:3e:d7:d0:78","host_name":"veth4BPCW2","mtu":1500,"state":"up","type":"broadcast"},"lo":{"addresses":[{"family":"inet","address":"127.0.0.1","netmask":"8","scope":"local"},{"family":"inet6","address":"::1","netmask":"128","scope":"local"}],"counters":{"bytes_received":2064,"bytes_sent":2064,"packets_received":24,"packets_sent":24},"hwaddr":"","host_name":"","mtu":65536,"state":"up","type":"loopback"}},"pid":25054,"processes":26,"cpu":{"usage":0}},"snapshots":[]},{"architecture":"x86_64","config":{"volatile.base_image":"f2228450779fee27020d6024af587379b8f51062c32a335327f2b028c924bfa1","volatile.eth0.hwaddr":"00:16:3e:8b:9e:ce","volatile.idmap.base":"0","volatile.idmap.next":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.idmap":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.power":"RUNNING"},"devices":{"root":{"path":"/","type":"disk"}},"ephemeral":false,"profiles":["default"],"stateful":false,"description":"","created_at":"2018-07-04T04:26:43Z","expanded_config":{"environment.http_proxy":"","user.network_mode":"link-local","volatile.base_image":"f2228450779fee27020d6024af587379b8f51062c32a335327f2b028c924bfa1","volatile.eth0.hwaddr":"00:16:3e:8b:9e:ce","volatile.idmap.base":"0","volatile.idmap.next":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.idmap":"[{\"Isuid\":true,\"Isgid\":false,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536},{\"Isuid\":false,\"Isgid\":true,\"Hostid\":100000,\"Nsid\":0,\"Maprange\":65536}]","volatile.last_state.power":"RUNNING"},"expanded_devices":{"eth0":{"name":"eth0","nictype":"bridged","parent":"lxdbr0","type":"nic"},"root":{"path":"/","type":"disk"}},"name":"webserver","status":"Running","status_code":103,"last_used_at":"0001-01-01T00:00:00Z","state":{"status":"Running","status_code":103,"disk":{"root":{"usage":14915584}},"memory":{"usage":71450624,"usage_peak":201383936,"swap_usage":0,"swap_usage_peak":0},"network":{"eth0":{"addresses":[{"family":"inet6","address":"fe80::216:3eff:fe8b:9ece","netmask":"64","scope":"link"}],"counters":{"bytes_received":1476,"bytes_sent":648,"packets_received":18,"packets_sent":8},"hwaddr":"00:16:3e:8b:9e:ce","host_name":"veth1CY7BO","mtu":1500,"state":"up","type":"broadcast"},"lo":{"addresses":[{"family":"inet","address":"127.0.0.1","netmask":"8","scope":"local"},{"family":"inet6","address":"::1","netmask":"128","scope":"local"}],"counters":{"bytes_received":2008,"bytes_sent":2008,"packets_received":24,"packets_sent":24},"hwaddr":"","host_name":"","mtu":65536,"state":"up","type":"loopback"}},"pid":23042,"processes":26,"cpu":{"usage":0}},"snapshots":[]}]`

	_, err := parseFile(test_input)
	if err != nil {
		t.Error("Error Parse JSON")
	}

	_, err = parseFile("NOT_TO_PARSE")
	if err == nil {
		t.Error("Error Parse JSON")
	}

}
